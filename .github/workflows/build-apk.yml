name: Build APK\n\non:\n  push:\n    branches: [ main ]\n  workflow_dispatch: # Required for triggering from API\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n    - name: Checkout project\n      uses: actions/checkout@v4\n\n    - name: Set up JDK 17\n      uses: actions/setup-java@v4\n      with:\n        distribution: 'temurin'\n        java-version: '17'\n\n    # --- BEGIN GRADLE CACHE SETUP ---
    - name: Setup Gradle Cache\n      uses: actions/cache@v4\n      with:\n        path: |\n          ~/.gradle/caches\n          ~/.gradle/wrapper\n        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}\n        restore-keys: |\n          ${{ runner.os }}-gradle-\n    # --- END GRADLE CACHE SETUP ---
\n    - name: Install Android SDK\n      run: |\n        mkdir -p $ANDROID_HOME/cmdline-tools\n        wget -q https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip -O cmdline-tools.zip\n        unzip -q cmdline-tools.zip -d $ANDROID_HOME/cmdline-tools\n        mv $ANDROID_HOME/cmdline-tools/cmdline-tools $ANDROID_HOME/cmdline-tools/latest\n        echo "PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin" >> $GITHUB_ENV\n      env:\n        ANDROID_HOME: /usr/local/lib/android/sdk\n\n    - name: Accept Android SDK licenses\n      run: yes | sdkmanager --licenses\n      env:\n        ANDROID_HOME: /usr/local/lib/android/sdk\n\n    - name: Verify Gradle wrapper exists\n      run: |\n        ls -l gradlew\n        if [ ! -f "./gradlew" ]; then echo "gradlew not found"; exit 1; fi\n\n    - name: Make gradlew executable\n      run: chmod +x ./gradlew\n\n    - name: Build the APK\n      run: ./gradlew assembleDebug --stacktrace --info\n      env:\n        ANDROID_HOME: /usr/local/lib/android/sdk\n        ANDROID_SDK_ROOT: /usr/local/lib/android/sdk\n\n    - name: Verify APK exists\n      run: |\n        ls -l app/build/outputs/apk/debug/\n        if [ ! -f "app/build/outputs/apk/debug/app-debug.apk" ]; then echo "APK not found"; exit 1; fi\n\n    - name: Upload APK artifact\n      uses: actions/upload-artifact@v4\n      with:\n        name: debug-apk\n        path: app/build/outputs/apk/debug/app-debug.apk\n